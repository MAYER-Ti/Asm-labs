.model small
.stack 100h

.data
    array DW 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ; ?????? ???????
    value DW 0                              ; ??? ?????? ?????????
    timer_start DW ?                        ; ????????? ???????? ???????
    timer_end DW ?                          ; ???????? ???????? ???????
    msg1 DB 'Direct Addressing Time: ', '$'
    msg2 DB 'Register Addressing Time: ', '$'
    msg3 DB 'Base Addressing Time: ', '$'
    newline DB 0Dh, 0Ah, '$'

.code
start:
    ; ????????? ?????????
    mov ax, @data
    mov ds, ax
    mov es, ax

    ; ===== ?????? ????????? =====
    call rdtsc_start                         ; ?????? ????????? ?????
    mov ax, array                            ; ?????? ?????? ??????? ???????
    mov value, ax
    call rdtsc_end                           ; ?????? ???????? ?????
    lea dx, msg1
    call print_string
    call print_time                          ; ??????? ?????????? ?????
    call print_newline

    ; ===== ??????????? ????????? =====
    call rdtsc_start
    mov bx, array                            ; ????????? ????? ??????? ? BX
    mov ax, bx                               ; ?????? ? ?????????
    call rdtsc_end
    lea dx, msg2
    call print_string
    call print_time
    call print_newline

    ; ===== ??????? ????????? =====
    call rdtsc_start
    mov bx, array
    mov ax, [bx]                             ; ?????? ? ??????? ???????? ???????
    call rdtsc_end
    lea dx, msg3
    call print_string
    call print_time
    call print_newline

    ; ===== ?????????? ????????? =====
    mov ah, 4Ch
    int 21h

; ===== ???????????? ????????? ??????? =====
rdtsc_start:
    db 0Fh, 31h                              ; ??????? RDTSC
    mov word ptr timer_start, ax             ; ????????? ??????? 16 ???
    ret

rdtsc_end:
    db 0Fh, 31h                              ; ??????? RDTSC
    mov word ptr timer_end, ax
    ret

; ===== ???????????? ?????? ??????? =====
print_time:
    mov ax, timer_end
    sub ax, timer_start                      ; ????????? ??????? ???????
    call print_number                        ; ??????????? ? ??????? ?????
    ret

; ===== ???????????? ?????? ?????? =====
print_string:
    mov ah, 09h
    int 21h
    ret

; ===== ???????????? ?????? ????? =====
print_number:
    ; ?????????????? ????? ? ?????? ? ?????
    xor bx, bx                               ; ??????? BX (??????? ????)
    mov cx, 10                               ; ????????
convert_loop:
    xor dx, dx                               ; ??????? DX
    div cx                                   ; AX / 10, ??????? ? DX
    push dx                                  ; ????????? ??????? (?????) ? ?????
    inc bx                                   ; ??????????? ??????? ????
    test ax, ax                              ; ???? AX = 0, ??? ????? ?????????
    jz output_digits
    jmp convert_loop
output_digits:
    pop dx                                   ; ??????????????? ????? ?? ?????
    add dl, '0'                              ; ??????????? ? ASCII
    mov ah, 02h                              ; ????? ???????
    int 21h
    dec bx                                   ; ????????? ???????
    jnz output_digits                        ; ???? ??? ???? ?????, ??????????
    ret

; ===== ???????????? ?????? ????? ?????? =====
print_newline:
    lea dx, newline
    call print_string
    ret

end start
