
mOpenFile macro fileName_, fileHandle_
    local open_error
    local done
    ; ??????? ???? (int 21h, 3Dh)
    lea dx, fileName_                   ; ????????? ?? ??? ?????
    mov ah, 3Dh                         ; ??????? ???????? ?????
    mov al, 0                           ; ????? (?????? ??????)
    mov cx, 0
    int 21h
    jc open_error                       ; ???? ??????, ???????
    jmp done
    open_error:
    ; ????? ????????? ?? ?????? ???????? ?????
    mov dx, offset open_err_msg
    mov ah, 09h
    int 21h
    mCloseFile fileHandle_
done:
    mov fileHandle_, ax                  ; ????????? ?????????? ?????
endm

mReadFileRowToStack macro addrToStr_, fileHandle_
    local readChar, endFile
    ; ????????? ?????? ??????????? ?? ??????? ???????? ??????,
    ; ?????? ??????????? ?????? ???????? ? ????    
    mov word ptr [addrToStr_], sp  ; ????????? ????? ?????? ? ????
    
readChar:
    ; ?????? ???????
    mov ah, 3Fh                    ; ??????? ?????? ?????
    mov bx, fileHandle_            ; ?????????? ?????
    lea dx, bufferChar             ; ????? ??? ?????? ???????
    mov cx, 1                      ; ????????? ???? ????
    int 21h
    jc endFile                     ; ???? ?????? ??????, ????? ?????
    
    cmp ax, 0                      ; ????????? ????? ?????
    je endFile                     ; ???? 0 ????, ????? ?????

    ; ????????? ?????? ? ????
    mov al, bufferChar             ; ????????? ??????
    push ax                        ; ????????? ? ????
    
    cmp bufferChar, 0Ah            ; ???????? ??????? ????? ??????
    jne readChar                   ; ???? ?? ????? ??????, ?????? ??????
    
endFile:
endm

mCloseFile macro fileHandle_
    ; ??????? ???? (int 21h, 3Eh)
    mov ah, 3Eh                         ; ??????? ???????? ?????
    mov bx, fileHandle                  ; ?????????? ?????
    int 21h
endm

mReadFile macro fileName_, fileHandle_, rowBegins_
    local readRow
; ?????? ?????? ????? ? ?????? ? ????
; ????????? ?????? ??????? ?????? ????? ? ?????
    mOpenFile fileName_, fileHandle_ ; ??????? ????
    
readRow:
    mReadFileRowToStack rowBegins_, fileHandle_  ; ????????? ??????  
    cmp ax, 0                                                ; ???? ?? ?????? ?? ????? ?????
    add rowBegins_, 2                                         ; ???????? ??? ?????????? ?????? ?????? ??????
    jne readRow
    
    mCloseFile fileHandle_
    
endm

mPrintString MACRO string
   mov ah, 9
   lea dx, string
   int 21h
endm

mInputString MACRO string
   mov ah, 0Ah
   mov byte ptr string, 100   ; ?????? ??? ?????
   lea dx, string
endm